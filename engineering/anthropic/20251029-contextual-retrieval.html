<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰ - Anthropic Engineering å®è·µ</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="æœ¬æ–‡æå‡ºäº† Contextual Retrieval æŠ€æœ¯ï¼Œé€šè¿‡ä¸ºæ–‡æ¡£å—æ·»åŠ ä¸Šä¸‹æ–‡è§£é‡Šï¼Œå°† RAG ç³»ç»Ÿçš„æ£€ç´¢å¤±è´¥ç‡é™ä½ 67%ï¼ˆä» 5.7% é™è‡³ 1.9%ï¼‰ã€‚æ ¸å¿ƒåˆ›æ–°æ˜¯ç´¢å¼•æ—¶çš„ä¸Šä¸‹æ–‡å¢å¼ºï¼šä½¿ç”¨ LLM ä¸ºæ¯ä¸ªå—ç”Ÿæˆç®€æ´çš„ä¸Šä¸‹æ–‡è¯´æ˜ï¼ˆ50-100 å­—ï¼‰ï¼Œç»“åˆ Contextual Embeddings å’Œ Contextual BM25 å®ç°æ··åˆæ£€ç´¢ã€‚æ–‡ç« è¯¦ç»†åˆ†æäº†å®ç°ç»†èŠ‚ï¼ˆæç¤ºå·¥ç¨‹ã€æ¨¡å‹é€‰æ‹©ã€Prompt Caching ä¼˜åŒ–ï¼‰ã€æˆæœ¬æ•ˆç›Šï¼ˆæ¯ 1M tokens ä»… $0.29ï¼‰ã€ä»¥åŠ Reranking çš„è¿›ä¸€æ­¥æå‡ã€‚åŸºäºä¸‰ä¸ªçœŸå®æ•°æ®é›†çš„åŸºå‡†æµ‹è¯•ï¼ŒéªŒè¯äº†è¯¥æ–¹æ³•çš„æ™®é€‚æ€§å’Œæ€§ä»·æ¯”ã€‚">
    <meta name="author" content="Anthropic Engineering Team">
    <meta name="keywords" content="Anthropic, AI, Claude, äººå·¥æ™ºèƒ½, å·¥ç¨‹å®è·µ, ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰">

    <!-- Open Graph Tags (Facebook, LinkedIn, Slack) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰">
    <meta property="og:description" content="æœ¬æ–‡æå‡ºäº† Contextual Retrieval æŠ€æœ¯ï¼Œé€šè¿‡ä¸ºæ–‡æ¡£å—æ·»åŠ ä¸Šä¸‹æ–‡è§£é‡Šï¼Œå°† RAG ç³»ç»Ÿçš„æ£€ç´¢å¤±è´¥ç‡é™ä½ 67%ï¼ˆä» 5.7% é™è‡³ 1.9%ï¼‰ã€‚æ ¸å¿ƒåˆ›æ–°æ˜¯ç´¢å¼•æ—¶çš„ä¸Šä¸‹æ–‡å¢å¼ºï¼šä½¿ç”¨ LLM ä¸ºæ¯ä¸ªå—ç”Ÿæˆç®€æ´çš„ä¸Šä¸‹æ–‡è¯´æ˜ï¼ˆ50-100 å­—ï¼‰ï¼Œç»“åˆ Contextual Embeddings å’Œ Contextual BM25 å®ç°æ··åˆæ£€ç´¢ã€‚æ–‡ç« è¯¦ç»†åˆ†æäº†å®ç°ç»†èŠ‚ï¼ˆæç¤ºå·¥ç¨‹ã€æ¨¡å‹é€‰æ‹©ã€Prompt Caching ä¼˜åŒ–ï¼‰ã€æˆæœ¬æ•ˆç›Šï¼ˆæ¯ 1M tokens ä»… $0.29ï¼‰ã€ä»¥åŠ Reranking çš„è¿›ä¸€æ­¥æå‡ã€‚åŸºäºä¸‰ä¸ªçœŸå®æ•°æ®é›†çš„åŸºå‡†æµ‹è¯•ï¼ŒéªŒè¯äº†è¯¥æ–¹æ³•çš„æ™®é€‚æ€§å’Œæ€§ä»·æ¯”ã€‚">
    <meta property="og:url" content="https://myaiswithpanda.github.io/ai-digest/engineering/anthropic/20251029-contextual-retrieval.html">
    <meta property="og:site_name" content="Anthropic Engineering ä¸­æ–‡å®è·µ">
    <meta property="og:image" content="https://myaiswithpanda.github.io/ai-digest/images/default-og.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="zh_CN">

    <!-- Article Specific OG Tags -->
    <meta property="article:published_time" content="2024-09-19">
    <meta property="article:author" content="Anthropic">
    <meta property="article:section" content="Engineering">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰">
    <meta name="twitter:description" content="æœ¬æ–‡æå‡ºäº† Contextual Retrieval æŠ€æœ¯ï¼Œé€šè¿‡ä¸ºæ–‡æ¡£å—æ·»åŠ ä¸Šä¸‹æ–‡è§£é‡Šï¼Œå°† RAG ç³»ç»Ÿçš„æ£€ç´¢å¤±è´¥ç‡é™ä½ 67%ï¼ˆä» 5.7% é™è‡³ 1.9%ï¼‰ã€‚æ ¸å¿ƒåˆ›æ–°æ˜¯ç´¢å¼•æ—¶çš„ä¸Šä¸‹æ–‡å¢å¼ºï¼šä½¿ç”¨ LLM ä¸ºæ¯ä¸ªå—ç”Ÿæˆç®€æ´çš„ä¸Šä¸‹æ–‡è¯´æ˜ï¼ˆ50-100 å­—ï¼‰ï¼Œç»“åˆ Contextual Embeddings å’Œ Contextual BM25 å®ç°æ··åˆæ£€ç´¢ã€‚æ–‡ç« è¯¦ç»†åˆ†æäº†å®ç°ç»†èŠ‚ï¼ˆæç¤ºå·¥ç¨‹ã€æ¨¡å‹é€‰æ‹©ã€Prompt Caching ä¼˜åŒ–ï¼‰ã€æˆæœ¬æ•ˆç›Šï¼ˆæ¯ 1M tokens ä»… $0.29ï¼‰ã€ä»¥åŠ Reranking çš„è¿›ä¸€æ­¥æå‡ã€‚åŸºäºä¸‰ä¸ªçœŸå®æ•°æ®é›†çš„åŸºå‡†æµ‹è¯•ï¼ŒéªŒè¯äº†è¯¥æ–¹æ³•çš„æ™®é€‚æ€§å’Œæ€§ä»·æ¯”ã€‚">
    <meta name="twitter:image" content="https://myaiswithpanda.github.io/ai-digest/images/default-og.png">
    <meta name="twitter:site" content="@AnthropicAI">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #191A1A;
            --secondary-color: #CC785C;
            --text-color: #2D2D2D;
            --text-light: #666;
            --bg-color: #FAFAF8;
            --code-bg: #F5F2ED;
            --border-color: #E5E5E5;
            --link-color: #CC785C;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            line-height: 1.8;
            color: var(--text-color);
            background: var(--bg-color);
            font-size: 16px;
            padding-top: 60px; /* ä¸ºé¡¶éƒ¨å¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        }

        /* é˜…è¯»è¿›åº¦æ¡ */
        #reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), #E89A7F);
            z-index: 1001;
            transition: width 0.1s ease;
        }

        /* é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª */
        .breadcrumb-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            padding: 12px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .breadcrumb-content {
            max-width: 920px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
        }

        .breadcrumb-nav a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.2s;
        }

        .breadcrumb-nav a:hover {
            opacity: 0.7;
        }

        .breadcrumb-separator {
            color: var(--text-light);
        }

        .breadcrumb-current {
            color: var(--text-color);
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 600px;
        }

        /* æµ®åŠ¨å›é¡¶æŒ‰é’® */
        #back-to-top {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 56px;
            height: 56px;
            background: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(204, 120, 92, 0.3);
            z-index: 999;
        }

        #back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        #back-to-top:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(204, 120, 92, 0.4);
        }

        #back-to-top svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* åœ†å½¢è¿›åº¦ç¯ */
        #back-to-top .progress-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        #back-to-top .progress-ring-circle {
            stroke: rgba(255, 255, 255, 0.3);
            stroke-width: 2;
            fill: none;
        }

        #back-to-top .progress-ring-progress {
            stroke: white;
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 164;
            stroke-dashoffset: 164;
            transition: stroke-dashoffset 0.1s ease;
        }

        .container {
            max-width: 920px;
            margin: 0 auto;
            padding: 60px 24px;
        }

        /* å¤´éƒ¨ */
        header {
            margin-bottom: 48px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meta-label {
            font-weight: 500;
        }

        .author {
            color: var(--secondary-color);
            font-weight: 600;
        }

        /* ç›®å½• */
        .toc {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 48px;
        }

        .toc-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color);
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .toc a:hover {
            color: var(--link-color);
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            background: white;
            border-radius: 8px;
            padding: 48px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 48px 0 24px 0;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--secondary-color);
        }

        h2:first-child {
            margin-top: 0;
        }

        h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 32px 0 16px 0;
        }

        h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 24px 0 12px 0;
        }

        p {
            margin: 16px 0;
            line-height: 1.8;
        }

        /* åˆ—è¡¨ */
        ul, ol {
            margin: 16px 0;
            padding-left: 28px;
        }

        li {
            margin: 8px 0;
        }

        /* é“¾æ¥ */
        a {
            color: var(--link-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        a:hover {
            border-bottom-color: var(--link-color);
        }

        /* ä»£ç  */
        code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "SF Mono", Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.9em;
            color: #d73a49;
        }

        pre {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            margin: 24px 0;
            overflow-x: auto;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-word;
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text-color);
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ASCII è‰ºæœ¯ */
        pre.ascii-art {
            background: #fafafa;
            border: 1px solid #ddd;
            font-family: "Courier New", Consolas, Monaco, monospace;
            font-size: 0.85rem;
            line-height: 1.2;
            white-space: pre;
            overflow-x: auto;
            color: #333;
        }

        /* Mermaid å›¾è¡¨ */
        .mermaid {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin: 32px 0;
            text-align: center;
            overflow-x: auto;
        }

        pre.mermaid {
            background: white;
            text-align: center;
        }

        /* å¼•ç”¨ */
        blockquote {
            border-left: 4px solid var(--secondary-color);
            padding-left: 20px;
            margin: 24px 0;
            color: var(--text-light);
            font-style: italic;
        }

        /* å›¾ç‰‡ */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 24px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .image-caption {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: -16px;
            margin-bottom: 24px;
        }

        /* è¡¨æ ¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--code-bg);
            font-weight: 600;
            color: var(--primary-color);
        }

        tr:hover {
            background: var(--bg-color);
        }

        /* é«˜äº®æ¡† */
        .highlight {
            background: #FFF9E6;
            border-left: 4px solid #FFD93D;
            padding: 16px 20px;
            margin: 24px 0;
            border-radius: 4px;
        }

        .highlight-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        /* é¡µè„š */
        footer {
            margin-top: 64px;
            padding-top: 32px;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container {
                padding: 32px 16px;
            }

            .content {
                padding: 24px 20px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            h3 {
                font-size: 1.2rem;
            }

            pre {
                padding: 16px;
                font-size: 0.85rem;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            body {
                background: white;
            }

            .container {
                max-width: 100%;
            }

            .toc {
                display: none;
            }

            a {
                color: var(--text-color);
                border-bottom: none;
            }

            pre {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- é˜…è¯»è¿›åº¦æ¡ -->
    <div id="reading-progress"></div>

    <!-- é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="breadcrumb-nav">
        <div class="breadcrumb-content">
            <a href="index.html">ğŸ“š æ–‡ç« ç´¢å¼•</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰</span>
        </div>
    </nav>

    <!-- æµ®åŠ¨å›é¡¶æŒ‰é’® -->
    <div id="back-to-top">
        <svg class="progress-ring">
            <circle class="progress-ring-circle" cx="28" cy="28" r="26"></circle>
            <circle class="progress-ring-progress" cx="28" cy="28" r="26"></circle>
        </svg>
        <svg viewBox="0 0 24 24">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </div>

    <div class="container">
        <header>
            <h1>ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰</h1>
            <div class="meta">
                <div class="meta-item">
                    <span class="meta-label">åŸæ–‡é“¾æ¥ï¼š</span>
                    <a href="https://www.anthropic.com/engineering/contextual-retrieval" target="_blank">https://www.anthropic.com/engineering/contextual-retrieval</a>
                </div>
                <div class="meta-item">
                    <span class="meta-label">å‘å¸ƒæ—¥æœŸï¼š</span>
                    <span>2024 å¹´ 9 æœˆ 19 æ—¥</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">æ•´ç†æ—¥æœŸï¼š</span>
                    <span>2026-02-10</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">æ•´ç†è€…ï¼š</span>
                    <span class="author">Panda</span>
                </div>
            </div>
        </header>

        <nav class="toc">
<div class="toc-title">ğŸ“‘ ç›®å½•</div>
<ul>
<li><a href="#rag">RAG å…¥é—¨ï¼šæ‰©å±•åˆ°æ›´å¤§çš„çŸ¥è¯†åº“</a></li>
  <li><a href="#rag_1">ä»€ä¹ˆæ˜¯ RAGï¼Ÿ</a></li>
  <li><a href="#rag_2">ä¼ ç»Ÿ RAG çš„å·¥ä½œæµç¨‹</a></li>
  <li><a href="#rag_3">ä¼ ç»Ÿ RAG çš„é—®é¢˜</a></li>
<li><a href="#_1">ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢</a></li>
  <li><a href="#_2">æ ¸å¿ƒæ€æƒ³</a></li>
  <li><a href="#_3">å·¥ä½œæµç¨‹</a></li>
  <li><a href="#_4">æ€§èƒ½æå‡</a></li>
  <li><a href="#_5">å®ç°ç»†èŠ‚</a></li>
  <li><a href="#contextual-bm25">Contextual BM25</a></li>
<li><a href="#reranking">é€šè¿‡ Reranking è¿›ä¸€æ­¥æå‡æ€§èƒ½</a></li>
  <li><a href="#_9">å·¥ä½œåŸç†</a></li>
  <li><a href="#reranking_1">Reranking æ¨¡å‹</a></li>
  <li><a href="#_10">æ€§èƒ½æå‡</a></li>
  <li><a href="#_11">æˆæœ¬æƒè¡¡</a></li>
<li><a href="#contextual-retrieval_1">å®Œæ•´çš„ Contextual Retrieval æµç¨‹</a></li>
  <li><a href="#_12">ç´¢å¼•é˜¶æ®µ</a></li>
  <li><a href="#_13">æ£€ç´¢é˜¶æ®µ</a></li>
  <li><a href="#_14">ç”Ÿæˆé˜¶æ®µ</a></li>
<li><a href="#_15">æˆæœ¬åˆ†æ</a></li>
  <li><a href="#_16">ä¸Šä¸‹æ–‡ç”Ÿæˆæˆæœ¬</a></li>
  <li><a href="#_17">æ£€ç´¢æˆæœ¬</a></li>
  <li><a href="#roi">ROI åˆ†æ</a></li>
<li><a href="#_18">å®é™…åº”ç”¨æ¡ˆä¾‹</a></li>
  <li><a href="#1_1">æ¡ˆä¾‹ 1ï¼šå®¢æˆ·æ”¯æŒçŸ¥è¯†åº“</a></li>
  <li><a href="#2">æ¡ˆä¾‹ 2ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ</a></li>
  <li><a href="#3_1">æ¡ˆä¾‹ 3ï¼šç ”ç©¶è®ºæ–‡æ£€ç´¢</a></li>
<li><a href="#_19">æœ€ä½³å®è·µ</a></li>
  <li><a href="#1_2">1. é€‰æ‹©åˆé€‚çš„å—å¤§å°</a></li>
  <li><a href="#2_1">2. ä¼˜åŒ–ä¸Šä¸‹æ–‡é•¿åº¦</a></li>
  <li><a href="#3-prompt-caching">3. ä½¿ç”¨ Prompt Caching</a></li>
  <li><a href="#4">4. ç›‘æ§å’Œè¿­ä»£</a></li>
<li><a href="#_20">å±€é™æ€§å’Œæ³¨æ„äº‹é¡¹</a></li>
  <li><a href="#1_3">1. ä¸Šä¸‹æ–‡ç”Ÿæˆæˆæœ¬</a></li>
  <li><a href="#2_2">2. ä¸Šä¸‹æ–‡è´¨é‡</a></li>
  <li><a href="#3_2">3. å»¶è¿Ÿ</a></li>
<li><a href="#_21">ç»“è®º</a></li>
  <li><a href="#_22">å…³é”®è¦ç‚¹</a></li>
  <li><a href="#_23">æ¨èé…ç½®</a></li>
  <li><a href="#_24">å¼€å§‹ä½¿ç”¨</a></li>
<li><a href="#i">é™„å½• Iï¼šåŸºå‡†æµ‹è¯•æ–¹æ³•</a></li>
  <li><a href="#_25">æ•°æ®é›†</a></li>
  <li><a href="#_26">è¯„ä¼°æŒ‡æ ‡</a></li>
  <li><a href="#_27">å®éªŒè®¾ç½®</a></li>
<li><a href="#_28">è‡´è°¢</a></li>
<li><a href="#_29">èµ„æº</a></li>
</ul>
</nav>

        <article class="content">
            
            <h1 id="contextual-retrieval">ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢ï¼ˆContextual Retrievalï¼‰</h1>
<p><strong>åŸæ–‡é“¾æ¥</strong>: https://www.anthropic.com/engineering/contextual-retrieval
<strong>å‘å¸ƒæ—¥æœŸ</strong>: 2024 å¹´ 9 æœˆ 19 æ—¥</p>
<p>åœ¨æ„å»º RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿæ—¶ï¼Œä¸€ä¸ªå…³é”®æŒ‘æˆ˜æ˜¯ç¡®ä¿åœ¨éœ€è¦æ—¶æ£€ç´¢åˆ°æ­£ç¡®çš„ä¿¡æ¯ã€‚ä¼ ç»Ÿçš„æ£€ç´¢æ–¹æ³•ç»å¸¸ä¼šé”™è¿‡å…³é”®ä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´ AI ç³»ç»Ÿç»™å‡ºä¸å®Œæ•´æˆ–ä¸å‡†ç¡®çš„ç­”æ¡ˆã€‚</p>
<p>æœ¬æ–‡ä»‹ç» <strong>Contextual Retrieval</strong>ï¼ˆä¸Šä¸‹æ–‡æ£€ç´¢ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§æ”¹è¿› RAG ç³»ç»Ÿçš„æŠ€æœ¯ï¼Œé€šè¿‡æ·»åŠ ä¸Šä¸‹æ–‡æ¥å¢å¼ºæ¯ä¸ªæ–‡æ¡£å—ï¼Œä½¿æ£€ç´¢æ›´åŠ å‡†ç¡®ã€‚ç»“åˆ Contextual Embeddings å’Œ Contextual BM25ï¼Œæˆ‘ä»¬å°†æ£€ç´¢å¤±è´¥ç‡é™ä½äº†é«˜è¾¾ <strong>67 %</strong>ï¼ˆä» 5.7 % é™è‡³ 1.9 %ï¼‰ã€‚</p>
<h2 id="rag">RAG å…¥é—¨ï¼šæ‰©å±•åˆ°æ›´å¤§çš„çŸ¥è¯†åº“</h2>
<h3 id="rag_1">ä»€ä¹ˆæ˜¯ RAGï¼Ÿ</h3>
<p>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯æ¥å¢å¼º LLM çš„èƒ½åŠ›ã€‚è¿™å…è®¸æ¨¡å‹è®¿é—®å…¶è®­ç»ƒæ•°æ®ä¹‹å¤–çš„ä¿¡æ¯ã€‚</p>
<h3 id="rag_2">ä¼ ç»Ÿ RAG çš„å·¥ä½œæµç¨‹</h3>
<ol>
<li><strong>æ–‡æ¡£å¤„ç†</strong>ï¼šå°†å¤§å‹æ–‡æ¡£åˆ†å‰²æˆè¾ƒå°çš„å—</li>
<li><strong>å‘é‡åŒ–</strong>ï¼šä¸ºæ¯ä¸ªå—åˆ›å»ºåµŒå…¥å‘é‡</li>
<li><strong>å­˜å‚¨</strong>ï¼šå°†å‘é‡å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­</li>
<li><strong>æ£€ç´¢</strong>ï¼šå½“ç”¨æˆ·æé—®æ—¶ï¼Œæ£€ç´¢æœ€ç›¸å…³çš„å—</li>
<li><strong>ç”Ÿæˆ</strong>ï¼šå°†æ£€ç´¢åˆ°çš„å—å’Œé—®é¢˜ä¸€èµ·å‘é€ç»™ LLM</li>
</ol>
<h3 id="rag_3">ä¼ ç»Ÿ RAG çš„é—®é¢˜</h3>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼š</p>
<p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«å…¬å¸è´¢åŠ¡æŠ¥å‘Šçš„çŸ¥è¯†åº“ã€‚ä¸€ä¸ªæ–‡æ¡£å—å¯èƒ½åŒ…å«ï¼š</p>
<div class="codehilite"><pre><span></span><code>ACME å…¬å¸ 2023 å¹´ç¬¬å››å­£åº¦æ”¶å…¥ä¸º $2.3Mï¼Œ
æ¯” 2023 å¹´ç¬¬ä¸‰å­£åº¦å¢é•¿ 15 %ã€‚
</code></pre></div> <p>å½“ç”¨æˆ·é—®"ACME åœ¨ 2023 å¹´ç¬¬å››å­£åº¦çš„æ”¶å…¥æ˜¯å¤šå°‘ï¼Ÿ"æ—¶ï¼Œè¿™ä¸ªå—åº”è¯¥è¢«æ£€ç´¢åˆ°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·é—®"ACME åœ¨ Q4 çš„æ”¶å…¥å¢é•¿äº†å¤šå°‘ï¼Ÿ"ï¼Œä¼ ç»Ÿçš„æ£€ç´¢æ–¹æ³•å¯èƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºï¼š</p>
<ol>
<li>å—ä¸­æ²¡æœ‰æ˜ç¡®æåˆ°"å¢é•¿"è¿™ä¸ªè¯</li>
<li>ç¼ºå°‘å…³äº ACME æ˜¯ä»€ä¹ˆç±»å‹å…¬å¸çš„ä¸Šä¸‹æ–‡</li>
<li>æ²¡æœ‰å…³äº Q3 æ”¶å…¥æ˜¯å¤šå°‘çš„ä¿¡æ¯æ¥è®¡ç®—å¢é•¿</li>
</ol>
<p><strong>é—®é¢˜çš„æ ¹æº</strong>ï¼šæ–‡æ¡£å—è„±ç¦»äº†å‘¨å›´çš„ä¸Šä¸‹æ–‡ã€‚</p>
<h2 id="_1">ä»‹ç»ä¸Šä¸‹æ–‡æ£€ç´¢</h2>
<p>Contextual Retrieval é€šè¿‡åœ¨ç´¢å¼•æ—¶ä¸ºæ¯ä¸ªå—æ·»åŠ ç›¸å…³ä¸Šä¸‹æ–‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="_2">æ ¸å¿ƒæ€æƒ³</h3>
<p>åœ¨å°†æ–‡æ¡£åˆ†å—å¹¶åˆ›å»ºåµŒå…¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ LLM ä¸ºæ¯ä¸ªå—ç”Ÿæˆç®€æ´çš„ä¸Šä¸‹æ–‡è§£é‡Šã€‚</p>
<h3 id="_3">å·¥ä½œæµç¨‹</h3>
<h4 id="1">1. ä¸Šä¸‹æ–‡ç”Ÿæˆ</h4>
<p><strong>æç¤ºæ¨¡æ¿</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;document&gt;</span>
{{WHOLE_DOCUMENT}}
<span class="nt">&lt;/document&gt;</span> ä»¥ä¸‹æ˜¯ä¸Šè¿°æ–‡æ¡£çš„ä¸€ä¸ªå—ï¼š
<span class="nt">&lt;chunk&gt;</span>
{{CHUNK_CONTENT}}
<span class="nt">&lt;/chunk&gt;</span> è¯·æä¾›ä¸€ä¸ªç®€æ´çš„ä¸Šä¸‹æ–‡ï¼ˆ50-100<span class="w"> </span>å­—ï¼‰ï¼Œè§£é‡Šè¿™ä¸ªå—ä¸æ–‡æ¡£çš„å…³ç³»ã€‚
åªè¿”å›ä¸Šä¸‹æ–‡ï¼Œä¸è¦åŠ å…¶ä»–å†…å®¹ã€‚
</code></pre></div> <p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>åŸå§‹å—ï¼š</p>
<div class="codehilite"><pre><span></span><code>å…¬å¸åœ¨ Q4 å®ç°äº† $2.3M çš„æ”¶å…¥ï¼ŒåŒæ¯”å¢é•¿ 15 %ã€‚
</code></pre></div> <p>ç”Ÿæˆçš„ä¸Šä¸‹æ–‡ï¼š</p>
<div class="codehilite"><pre><span></span><code>è¿™ä¸ªå—æè¿°äº† ACME å…¬å¸åœ¨ 2023 å¹´ç¬¬å››å­£åº¦çš„è´¢åŠ¡è¡¨ç°ï¼Œ
åŒ…æ‹¬æ”¶å…¥æ•°å­—å’Œä¸å‰ä¸€å­£åº¦çš„æ¯”è¾ƒã€‚
</code></pre></div> <h4 id="2-contextualized-chunk">2. ä¸Šä¸‹æ–‡å—ï¼ˆContextualized Chunkï¼‰</h4>
<p>å°†ç”Ÿæˆçš„ä¸Šä¸‹æ–‡æ·»åŠ åˆ°åŸå§‹å—å‰é¢ï¼š</p>
<div class="codehilite"><pre><span></span><code>[ä¸Šä¸‹æ–‡] è¿™ä¸ªå—æè¿°äº† ACME å…¬å¸åœ¨ 2023 å¹´ç¬¬å››å­£åº¦çš„è´¢åŠ¡è¡¨ç°ï¼Œ
åŒ…æ‹¬æ”¶å…¥æ•°å­—å’Œä¸å‰ä¸€å­£åº¦çš„æ¯”è¾ƒã€‚ [å†…å®¹] å…¬å¸åœ¨ Q4 å®ç°äº† $2.3M çš„æ”¶å…¥ï¼ŒåŒæ¯”å¢é•¿ 15 %ã€‚
</code></pre></div> <h4 id="3">3. ç´¢å¼•å’Œæ£€ç´¢</h4>
<p>ä½¿ç”¨ä¸Šä¸‹æ–‡å—åˆ›å»ºåµŒå…¥å¹¶å­˜å‚¨ã€‚æ£€ç´¢æ—¶ï¼Œä¸Šä¸‹æ–‡å¸®åŠ©åŒ¹é…æ›´å¹¿æ³›çš„æŸ¥è¯¢ã€‚</p>
<h3 id="_4">æ€§èƒ½æå‡</h3>
<p>æˆ‘ä»¬åœ¨åŒ…å« Codebaseã€ArXiv è®ºæ–‡å’Œ Fiction ä¹¦ç±çš„åŸºå‡†æµ‹è¯•ä¸­è¯„ä¼°äº† Contextual Retrievalï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ£€ç´¢å¤±è´¥ç‡</th>
<th>æ”¹è¿›</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŸºçº¿ï¼ˆä¼ ç»Ÿ RAGï¼‰</td>
<td>5.7 %</td>
<td>-</td>
</tr>
<tr>
<td>Contextual Embeddings</td>
<td>3.5 %</td>
<td><strong>-39 %</strong></td>
</tr>
<tr>
<td>Contextual BM25</td>
<td>3.2 %</td>
<td><strong>-44 %</strong></td>
</tr>
<tr>
<td>Contextual Embeddings + BM25</td>
<td><strong>1.9 %</strong></td>
<td><strong>-67 %</strong></td>
</tr>
</tbody>
</table>
<p><strong>å…³é”®å‘ç°</strong>ï¼š</p>
<ul>
<li>å•ç‹¬ä½¿ç”¨ Contextual Embeddings å¯é™ä½ 39 % çš„å¤±è´¥ç‡</li>
<li>ç»“åˆ BM25 å¯è¿›ä¸€æ­¥é™è‡³ 67 %</li>
<li>åœ¨æ‰€æœ‰ä¸‰ä¸ªæ•°æ®é›†ä¸Šéƒ½æœ‰æ˜¾è‘—æ”¹è¿›</li>
</ul>
<h3 id="_5">å®ç°ç»†èŠ‚</h3>
<h4 id="_6">æç¤ºå·¥ç¨‹</h4>
<p>æˆ‘ä»¬æµ‹è¯•äº†ä¸åŒçš„æç¤ºç­–ç•¥ï¼š</p>
<p><strong>ç®€å•æç¤º</strong>ï¼ˆ50-100 å­—ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>ä¸ºè¿™ä¸ªå—æä¾›ç®€æ´çš„ä¸Šä¸‹æ–‡è§£é‡Šã€‚
</code></pre></div> <p><strong>è¯¦ç»†æç¤º</strong>ï¼ˆ100-200 å­—ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>æä¾›è¯¦ç»†çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ï¼š - è¿™ä¸ªå—åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®
- å®ƒä¸å‰åå—çš„å…³ç³»
- å…³é”®å®ä½“å’Œæ¦‚å¿µ
</code></pre></div> <p><strong>ç»“æœ</strong>ï¼šç®€å•æç¤ºè¡¨ç°æ›´å¥½ï¼Œå› ä¸ºå®ƒä»¬ï¼š</p>
<ul>
<li>æ›´å¿«ï¼ˆæ›´å°‘çš„ tokensï¼‰</li>
<li>æ›´ä¸“æ³¨ï¼ˆé¿å…è¿‡åº¦è§£é‡Šï¼‰</li>
<li>æ›´ä¾¿å®œï¼ˆé™ä½ API æˆæœ¬ï¼‰</li>
</ul>
<h4 id="_7">æ¨¡å‹é€‰æ‹©</h4>
<p>æˆ‘ä»¬æ¯”è¾ƒäº†ä¸åŒçš„æ¨¡å‹ç”¨äºä¸Šä¸‹æ–‡ç”Ÿæˆï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å‹</th>
<th>Top-20 å‡†ç¡®ç‡</th>
<th>æˆæœ¬ï¼ˆæ¯ç™¾ä¸‡ tokensï¼‰</th>
<th>å»¶è¿Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Claude 3 Haiku</td>
<td>67.8 %</td>
<td>$0.30</td>
<td>å¿«</td>
</tr>
<tr>
<td>Claude 3.5 Sonnet</td>
<td><strong>68.1 %</strong></td>
<td>$3.00</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td>GPT-4o-mini</td>
<td>65.2 %</td>
<td>$0.60</td>
<td>å¿«</td>
</tr>
</tbody>
</table>
<p><strong>æ¨è</strong>ï¼šClaude 3 Haiku æä¾›æœ€ä½³çš„æ€§ä»·æ¯”ã€‚</p>
<h3 id="contextual-bm25">Contextual BM25</h3>
<p>BM25 æ˜¯ä¸€ç§åŸºäºå…³é”®è¯çš„ä¼ ç»Ÿæ£€ç´¢ç®—æ³•ã€‚Contextual BM25 å°†ä¸Šä¸‹æ–‡æ·»åŠ åˆ° BM25 ç´¢å¼•ä¸­ã€‚</p>
<h4 id="embeddings-bm25">ä¸ºä»€ä¹ˆç»“åˆ Embeddings å’Œ BM25ï¼Ÿ</h4>
<ul>
<li><strong>Embeddings</strong>ï¼šæ“…é•¿è¯­ä¹‰åŒ¹é…ï¼ˆåŒä¹‰è¯ã€ç›¸å…³æ¦‚å¿µï¼‰</li>
<li><strong>BM25</strong>ï¼šæ“…é•¿ç²¾ç¡®å…³é”®è¯åŒ¹é…ï¼ˆä¸“æœ‰åè¯ã€æŠ€æœ¯æœ¯è¯­ï¼‰</li>
</ul>
<p><strong>æ··åˆæœç´¢</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">embedding_results</span> <span class="o">=</span> <span class="n">search_embeddings</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">bm25_results</span> <span class="o">=</span> <span class="n">search_bm25</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># ç»“åˆå¹¶é‡æ–°æ’åº</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">embedding_results</span><span class="p">:</span> <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">embedding_score</span> <span class="o">*</span> <span class="mf">0.6</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">bm25_results</span><span class="p">:</span> <span class="n">score</span> <span class="o">+=</span> <span class="n">bm25_results</span><span class="p">[</span><span class="n">result</span><span class="p">]</span><span class="o">.</span><span class="n">score</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">result</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span> <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div> <h4 id="_8">æ€§èƒ½å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ£€ç´¢æ–¹æ³•</th>
<th>Top-20 å‡†ç¡®ç‡</th>
<th>ç›¸å¯¹åŸºçº¿æ”¹è¿›</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¼ ç»Ÿ Embeddings</td>
<td>94.3 %</td>
<td>-</td>
</tr>
<tr>
<td>Contextual Embeddings</td>
<td>96.5 %</td>
<td>+2.3 %</td>
</tr>
<tr>
<td>BM25</td>
<td>91.2 %</td>
<td>-3.1 %</td>
</tr>
<tr>
<td>Contextual BM25</td>
<td>95.6 %</td>
<td>+1.3 %</td>
</tr>
<tr>
<td>Contextual Embeddings + BM25</td>
<td><strong>98.1 %</strong></td>
<td><strong>+3.8 %</strong></td>
</tr>
</tbody>
</table>
<h2 id="reranking">é€šè¿‡ Reranking è¿›ä¸€æ­¥æå‡æ€§èƒ½</h2>
<p>Reranking æ˜¯åœ¨åˆå§‹æ£€ç´¢åé‡æ–°å¯¹ç»“æœè¿›è¡Œæ’åºçš„è¿‡ç¨‹ã€‚</p>
<h3 id="_9">å·¥ä½œåŸç†</h3>
<ol>
<li><strong>åˆå§‹æ£€ç´¢</strong>ï¼šä½¿ç”¨ Contextual Retrieval è·å– top-20 ç»“æœ</li>
<li><strong>Reranking</strong>ï¼šä½¿ç”¨æ›´å¼ºå¤§çš„æ¨¡å‹é‡æ–°è¯„ä¼°ç›¸å…³æ€§</li>
<li><strong>æœ€ç»ˆé€‰æ‹©</strong>ï¼šé€‰æ‹© top-k æœ€ç›¸å…³çš„ç»“æœ</li>
</ol>
<h3 id="reranking_1">Reranking æ¨¡å‹</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ Cohere çš„ Rerank æ¨¡å‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">cohere</span> <span class="n">co</span> <span class="o">=</span> <span class="n">cohere</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;your_api_key&quot;</span><span class="p">)</span> <span class="c1"># åˆå§‹æ£€ç´¢</span>
<span class="n">initial_results</span> <span class="o">=</span> <span class="n">contextual_retrieval</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># Reranking</span>
<span class="n">reranked</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">rerank</span><span class="p">(</span> <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">documents</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">initial_results</span><span class="p">],</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;rerank-english-v3.0&quot;</span>
<span class="p">)</span> <span class="n">final_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_results</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reranked</span><span class="o">.</span><span class="n">results</span><span class="p">]</span>
</code></pre></div> <h3 id="_10">æ€§èƒ½æå‡</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>Top-20 å‡†ç¡®ç‡</th>
<th>æ£€ç´¢å¤±è´¥ç‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>Contextual Embeddings + BM25</td>
<td>98.1 %</td>
<td>1.9 %</td>
</tr>
<tr>
<td>+ Reranking</td>
<td><strong>98.7 %</strong></td>
<td><strong>1.3 %</strong></td>
</tr>
</tbody>
</table>
<p><strong>é¢å¤–æ”¹è¿›</strong>ï¼šReranking å°†å¤±è´¥ç‡è¿›ä¸€æ­¥é™ä½ 32 %ã€‚</p>
<h3 id="_11">æˆæœ¬æƒè¡¡</h3>
<p>Reranking å¢åŠ äº†æˆæœ¬ï¼Œä½†æ˜¾è‘—æé«˜äº†å‡†ç¡®æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ¯ 1M tokens æˆæœ¬</th>
<th>å‡†ç¡®ç‡</th>
<th>æˆæœ¬æ•ˆç›Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ—  Reranking</td>
<td>$1.00</td>
<td>98.1 %</td>
<td>â­â­â­</td>
</tr>
<tr>
<td>Reranking</td>
<td>$1.50</td>
<td>98.7 %</td>
<td>â­â­â­â­</td>
</tr>
</tbody>
</table>
<p><strong>å»ºè®®</strong>ï¼šå¯¹äºå…³é”®ä»»åŠ¡åº”ç”¨ï¼ŒReranking çš„æˆæœ¬æ˜¯å€¼å¾—çš„ã€‚</p>
<h2 id="contextual-retrieval_1">å®Œæ•´çš„ Contextual Retrieval æµç¨‹</h2>
<h3 id="_12">ç´¢å¼•é˜¶æ®µ</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">anthropic</span> <span class="kn">import</span> <span class="n">Anthropic</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Anthropic</span><span class="p">()</span> <span class="k">def</span> <span class="nf">create_contextual_chunks</span><span class="p">(</span><span class="n">document</span><span class="p">):</span> <span class="c1"># 1. åˆ†å—</span> <span class="n">chunks</span> <span class="o">=</span> <span class="n">split_document</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span> <span class="c1"># 2. ä¸ºæ¯ä¸ªå—ç”Ÿæˆä¸Šä¸‹æ–‡</span> <span class="n">contextual_chunks</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span> <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> &lt;document&gt;</span>
<span class="s2"> </span><span class="si">{</span><span class="n">document</span><span class="si">}</span>
<span class="s2"> &lt;/document&gt;</span> <span class="s2"> ä¸ºè¿™ä¸ªå—æä¾›ç®€æ´ä¸Šä¸‹æ–‡ï¼ˆ50-100 å­—ï¼‰ï¼š</span>
<span class="s2"> &lt;chunk&gt;</span>
<span class="s2"> </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span>
<span class="s2"> &lt;/chunk&gt;</span>
<span class="s2"> &quot;&quot;&quot;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-haiku-20240307&quot;</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span> <span class="p">)</span> <span class="n">context</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="n">contextual_chunk</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&quot;</span> <span class="n">contextual_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contextual_chunk</span><span class="p">)</span> <span class="k">return</span> <span class="n">contextual_chunks</span> <span class="k">def</span> <span class="nf">index_document</span><span class="p">(</span><span class="n">document</span><span class="p">):</span> <span class="n">chunks</span> <span class="o">=</span> <span class="n">create_contextual_chunks</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="c1"># 3. åˆ›å»º embeddings</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="c1"># 4. åˆ›å»º BM25 ç´¢å¼•</span> <span class="n">bm25_index</span> <span class="o">=</span> <span class="n">create_bm25_index</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="c1"># 5. å­˜å‚¨</span> <span class="n">store_in_vector_db</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span> <span class="n">store_bm25_index</span><span class="p">(</span><span class="n">bm25_index</span><span class="p">)</span>
</code></pre></div> <h3 id="_13">æ£€ç´¢é˜¶æ®µ</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># 1. æ··åˆæ£€ç´¢</span> <span class="n">embedding_results</span> <span class="o">=</span> <span class="n">search_embeddings</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="n">bm25_results</span> <span class="o">=</span> <span class="n">search_bm25</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># 2. ç»“åˆç»“æœ</span> <span class="n">combined</span> <span class="o">=</span> <span class="n">combine_results</span><span class="p">(</span> <span class="n">embedding_results</span><span class="p">,</span> <span class="n">bm25_results</span><span class="p">,</span> <span class="n">embedding_weight</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">bm25_weight</span><span class="o">=</span><span class="mf">0.4</span> <span class="p">)</span> <span class="c1"># 3. Rerankingï¼ˆå¯é€‰ï¼‰</span> <span class="k">if</span> <span class="n">use_reranking</span><span class="p">:</span> <span class="n">reranked</span> <span class="o">=</span> <span class="n">rerank</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">combined</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="n">top_k</span><span class="p">)</span> <span class="k">return</span> <span class="n">reranked</span> <span class="k">return</span> <span class="n">combined</span><span class="p">[:</span><span class="n">top_k</span><span class="p">]</span>
</code></pre></div> <h3 id="_14">ç”Ÿæˆé˜¶æ®µ</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_answer</span><span class="p">(</span><span class="n">query</span><span class="p">):</span> <span class="c1"># æ£€ç´¢ç›¸å…³å—</span> <span class="n">relevant_chunks</span> <span class="o">=</span> <span class="n">retrieve</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># æ„å»ºæç¤º</span> <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">relevant_chunks</span><span class="p">])</span> <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š</span> <span class="s2"> &lt;context&gt;</span>
<span class="s2"> </span><span class="si">{</span><span class="n">context</span><span class="si">}</span>
<span class="s2"> &lt;/context&gt;</span> <span class="s2"> &lt;question&gt;</span>
<span class="s2"> </span><span class="si">{</span><span class="n">query</span><span class="si">}</span>
<span class="s2"> &lt;/question&gt;</span> <span class="s2"> è¯·æä¾›å‡†ç¡®ã€ç®€æ´çš„ç­”æ¡ˆã€‚</span>
<span class="s2"> &quot;&quot;&quot;</span> <span class="c1"># ç”Ÿæˆç­”æ¡ˆ</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-5-sonnet-20241022&quot;</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span> <span class="p">)</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</code></pre></div> <h2 id="_15">æˆæœ¬åˆ†æ</h2>
<h3 id="_16">ä¸Šä¸‹æ–‡ç”Ÿæˆæˆæœ¬</h3>
<p>å‡è®¾ï¼š</p>
<ul>
<li>æ–‡æ¡£å¤§å°ï¼š1M tokens</li>
<li>å—å¤§å°ï¼š800 tokens</li>
<li>å—æ•°é‡ï¼š~1,250 å—</li>
<li>æ¯ä¸ªä¸Šä¸‹æ–‡ï¼š75 tokens</li>
</ul>
<p><strong>ä½¿ç”¨ Claude 3 Haiku</strong>ï¼š</p>
<ul>
<li>
<p>è¾“å…¥ tokensï¼š1,250 Ã— 800 = 1M tokens = <strong>$0.25</strong></p>
</li>
<li>
<p>è¾“å‡º tokensï¼š1,250 Ã— 75 = 93,750 tokens = <strong>$0.04</strong></p>
</li>
<li>
<p><strong>æ€»æˆæœ¬ï¼š$0.29 æ¯ 1M tokens</strong></p>
</li>
</ul>
<p><strong>ä½¿ç”¨ Prompt Caching</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜æ•´ä¸ªæ–‡æ¡£ï¼ˆ1M tokensï¼‰</li>
<li>å†™å…¥ç¼“å­˜ï¼š$0.30</li>
<li>åç»­å—è¯»å–ç¼“å­˜ï¼š$0.03ï¼ˆæ¯ä¸ªå—ï¼‰</li>
<li><strong>æ€»æˆæœ¬ï¼šé™ä½åˆ° $0.22 æ¯ 1M tokens</strong></li>
</ul>
<h3 id="_17">æ£€ç´¢æˆæœ¬</h3>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>æ¯ 1000 æ¬¡æŸ¥è¯¢æˆæœ¬</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Embedding æœç´¢</td>
<td>$0.10</td>
<td>å‘é‡æ•°æ®åº“æŸ¥è¯¢</td>
</tr>
<tr>
<td>BM25 æœç´¢</td>
<td>$0.02</td>
<td>å…³é”®è¯åŒ¹é…</td>
</tr>
<tr>
<td>Reranking</td>
<td>$0.50</td>
<td>Cohere API</td>
</tr>
<tr>
<td><strong>æ€»è®¡</strong></td>
<td><strong>$0.62</strong></td>
<td>æ¯ 1000 æ¬¡æŸ¥è¯¢</td>
</tr>
</tbody>
</table>
<h3 id="roi">ROI åˆ†æ</h3>
<p>å¯¹äºæ¯æœˆ 100K æŸ¥è¯¢çš„ç³»ç»Ÿï¼š</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>ä¼ ç»Ÿ RAG</th>
<th>Contextual Retrieval</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‡†ç¡®ç‡</td>
<td>94.3 %</td>
<td>98.7 %</td>
</tr>
<tr>
<td>æœˆæˆæœ¬</td>
<td>$10</td>
<td>$72</td>
</tr>
<tr>
<td>å¤±è´¥æŸ¥è¯¢</td>
<td>5,700</td>
<td>1,300</td>
</tr>
<tr>
<td>èŠ‚çœçš„äººå·¥å®¡æŸ¥</td>
<td>-</td>
<td>4,400 Ã— $2 = <strong>$8,800</strong></td>
</tr>
</tbody>
</table>
<p><strong>å‡€èŠ‚çœ</strong>ï¼š$8,800 - $62 = <strong>$8,738/æœˆ</strong></p>
<h2 id="_18">å®é™…åº”ç”¨æ¡ˆä¾‹</h2>
<h3 id="1_1">æ¡ˆä¾‹ 1ï¼šå®¢æˆ·æ”¯æŒçŸ¥è¯†åº“</h3>
<p><strong>åœºæ™¯</strong>ï¼šç”µå•†å…¬å¸æœ‰ 10,000+ ä¸ªäº§å“å’Œæ”¿ç­–æ–‡æ¡£</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢ï¼š"What's the return policy for electronics?"</li>
<li>ä¼ ç»Ÿ RAG æ£€ç´¢åˆ°é€šç”¨é€€è´§æ”¿ç­–ï¼Œé—æ¼äº†ç”µå­äº§å“çš„ç‰¹æ®Šè§„å®š</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>[ä¸Šä¸‹æ–‡] è¿™éƒ¨åˆ†æè¿°äº†ç”µå­äº§å“ç±»åˆ«çš„ç‰¹æ®Šé€€è´§æ”¿ç­–ï¼Œ
åŒ…æ‹¬ 30 å¤©çª—å£æœŸå’Œå¿…éœ€çš„åŸåŒ…è£…è¦æ±‚ã€‚ [å†…å®¹] ç”µå­äº§å“å¿…é¡»åœ¨è´­ä¹°å 30 å¤©å†…é€€è´§ï¼Œ
ä¸”å¿…é¡»åŒ…å«æ‰€æœ‰åŸå§‹åŒ…è£…å’Œé…ä»¶ã€‚
</code></pre></div> <p><strong>ç»“æœ</strong>ï¼šå‡†ç¡®ç‡ä» 89 % æå‡åˆ° 97 %ã€‚</p>
<h3 id="2">æ¡ˆä¾‹ 2ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>ï¼šå¾‹å¸ˆäº‹åŠ¡æ‰€å¤„ç†æ•°åƒé¡µåˆåŒ</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢ï¼š"What are the termination clauses in Section 5?"</li>
<li>ä¼ ç»Ÿæ–¹æ³•éš¾ä»¥åŒºåˆ†ä¸åŒéƒ¨åˆ†çš„ç±»ä¼¼æ¡æ¬¾</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>[ä¸Šä¸‹æ–‡] è¿™æ˜¯åˆåŒç¬¬ 5 èŠ‚ä¸­çš„ç»ˆæ­¢æ¡æ¬¾ï¼Œ
é€‚ç”¨äºä¾›åº”å•†è¿çº¦æƒ…å†µã€‚ [å†…å®¹] è‹¥ä¾›åº”å•†è¿ç»­ 30 å¤©æœªå±¥è¡Œä¹‰åŠ¡ï¼Œ
ä¹°æ–¹å¯ç«‹å³ç»ˆæ­¢åˆåŒã€‚
</code></pre></div> <p><strong>ç»“æœ</strong>ï¼šæ£€ç´¢å‡†ç¡®ç‡æå‡ 45 %ã€‚</p>
<h3 id="3_1">æ¡ˆä¾‹ 3ï¼šç ”ç©¶è®ºæ–‡æ£€ç´¢</h3>
<p><strong>åœºæ™¯</strong>ï¼šå­¦æœ¯æœç´¢å¼•æ“ç´¢å¼• 1M+ è®ºæ–‡</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æŸ¥è¯¢ï¼š"Recent advances in transformer architectures"</li>
<li>ä¼ ç»Ÿæ–¹æ³•è¿”å›è¿‡æ—¶æˆ–ä¸ç›¸å…³çš„è®ºæ–‡</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>[ä¸Šä¸‹æ–‡] è¿™éƒ¨åˆ†æ¥è‡ª 2024 å¹´å‘è¡¨çš„å…³äº
é«˜æ•ˆ Transformer å˜ä½“çš„è®ºæ–‡çš„æ–¹æ³•å­¦éƒ¨åˆ†ã€‚ [å†…å®¹] æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œ
å°†è®¡ç®—å¤æ‚åº¦ä» O (nÂ²) é™ä½åˆ° O (n log n)ã€‚
</code></pre></div> <p><strong>ç»“æœ</strong>ï¼šç›¸å…³æ€§ä» 82 % æå‡åˆ° 94 %ã€‚</p>
<h2 id="_19">æœ€ä½³å®è·µ</h2>
<h3 id="1_2">1. é€‰æ‹©åˆé€‚çš„å—å¤§å°</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># æµ‹è¯•ä¸åŒå—å¤§å°</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1600</span><span class="p">]</span>
<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">chunk_sizes</span><span class="p">:</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluate_chunk_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span> <span class="c1"># ç»“æœï¼š</span>
<span class="c1"># Size 400: 95.2 %</span>
<span class="c1"># Size 800: 98.1 % â† æœ€ä½³</span>
<span class="c1"># Size 1200: 97.3 %</span>
<span class="c1"># Size 1600: 96.1 %</span>
</code></pre></div> <p><strong>æ¨è</strong>ï¼š800 tokens æ˜¯å¤§å¤šæ•°ç”¨ä¾‹çš„æœ€ä½³é€‰æ‹©ã€‚</p>
<h3 id="2_1">2. ä¼˜åŒ–ä¸Šä¸‹æ–‡é•¿åº¦</h3>
<div class="codehilite"><pre><span></span><code><span class="n">context_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">]</span>
<span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">context_lengths</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">evaluate_context_length</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">% ($</span><span class="si">{</span><span class="n">cost</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span> <span class="c1"># ç»“æœï¼š</span>
<span class="c1"># Length 50: 97.8 % ($0.28)</span>
<span class="c1"># Length 75: 98.1 % ($0.29) â† æœ€ä½³</span>
<span class="c1"># Length 100: 98.2 % ($0.31)</span>
<span class="c1"># Length 150: 98.2 % ($0.36)</span>
</code></pre></div> <p><strong>æ¨è</strong>ï¼š50-100 tokens æä¾›æœ€ä½³å¹³è¡¡ã€‚</p>
<h3 id="3-prompt-caching">3. ä½¿ç”¨ Prompt Caching</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># å¯ç”¨ Prompt Caching</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-3-haiku-20240307&quot;</span><span class="p">,</span> <span class="n">max_tokens</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;ä½ æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç”ŸæˆåŠ©æ‰‹ã€‚&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&lt;document&gt;</span><span class="si">{</span><span class="n">full_document</span><span class="si">}</span><span class="s2">&lt;/document&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;cache_control&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ephemeral&quot;</span><span class="p">}</span> <span class="p">}</span> <span class="p">],</span> <span class="n">messages</span><span class="o">=</span><span class="p">[{</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;ä¸ºè¿™ä¸ªå—ç”Ÿæˆä¸Šä¸‹æ–‡ï¼š</span><span class="se">\n</span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}]</span>
<span class="p">)</span>
</code></pre></div> <p><strong>èŠ‚çœ</strong>ï¼šé™ä½æˆæœ¬é«˜è¾¾ 90 %ã€‚</p>
<h3 id="4">4. ç›‘æ§å’Œè¿­ä»£</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># è¿½è¸ªå…³é”®æŒ‡æ ‡</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;retrieval_accuracy&quot;</span><span class="p">:</span> <span class="mf">0.981</span><span class="p">,</span> <span class="s2">&quot;avg_latency_ms&quot;</span><span class="p">:</span> <span class="mi">245</span><span class="p">,</span> <span class="s2">&quot;cost_per_query&quot;</span><span class="p">:</span> <span class="mf">0.00062</span><span class="p">,</span> <span class="s2">&quot;cache_hit_rate&quot;</span><span class="p">:</span> <span class="mf">0.87</span>
<span class="p">}</span> <span class="c1"># è®¾ç½®è­¦æŠ¥</span>
<span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;retrieval_accuracy&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.95</span><span class="p">:</span> <span class="n">alert</span><span class="p">(</span><span class="s2">&quot;Accuracy dropped below threshold&quot;</span><span class="p">)</span>
</code></pre></div> <h2 id="_20">å±€é™æ€§å’Œæ³¨æ„äº‹é¡¹</h2>
<h3 id="1_3">1. ä¸Šä¸‹æ–‡ç”Ÿæˆæˆæœ¬</h3>
<p>å¯¹äºéå¸¸å¤§çš„æ–‡æ¡£é›†ï¼ˆTB çº§ï¼‰ï¼Œåˆå§‹ä¸Šä¸‹æ–‡ç”Ÿæˆå¯èƒ½å¾ˆæ˜‚è´µã€‚</p>
<p><strong>ç¼“è§£æªæ–½</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹ï¼ˆHaikuï¼‰</li>
<li>æ‰¹é‡å¤„ç†</li>
<li>å¯ç”¨ Prompt Caching</li>
<li>å¢é‡ç´¢å¼•ï¼ˆåªå¤„ç†æ–°æ–‡æ¡£ï¼‰</li>
</ul>
<h3 id="2_2">2. ä¸Šä¸‹æ–‡è´¨é‡</h3>
<p>LLM ç”Ÿæˆçš„ä¸Šä¸‹æ–‡å¯èƒ½ä¸å®Œç¾ã€‚</p>
<p><strong>ç¼“è§£æªæ–½</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ˜ç¡®çš„æç¤ºæ¨¡æ¿</li>
<li>äººå·¥å®¡æŸ¥ç¤ºä¾‹ä¸Šä¸‹æ–‡</li>
<li>A/B æµ‹è¯•ä¸åŒæç¤ºç­–ç•¥</li>
<li>æ”¶é›†ç”¨æˆ·åé¦ˆ</li>
</ul>
<h3 id="3_2">3. å»¶è¿Ÿ</h3>
<p>Reranking å¢åŠ äº†é¢å¤–çš„å»¶è¿Ÿï¼ˆ~50-100msï¼‰ã€‚</p>
<p><strong>ç¼“è§£æªæ–½</strong>ï¼š</p>
<ul>
<li>ä»…åœ¨éœ€è¦é«˜ç²¾åº¦æ—¶ä½¿ç”¨ Reranking</li>
<li>å¼‚æ­¥ Rerankingï¼ˆåå°æ”¹è¿›ç»“æœï¼‰</li>
<li>ç¼“å­˜å¸¸è§æŸ¥è¯¢ç»“æœ</li>
</ul>
<h2 id="_21">ç»“è®º</h2>
<p>Contextual Retrieval é€šè¿‡åœ¨ç´¢å¼•æ—¶æ·»åŠ ä¸Šä¸‹æ–‡æ˜¾è‘—æ”¹è¿›äº† RAG ç³»ç»Ÿï¼š</p>
<h3 id="_22">å…³é”®è¦ç‚¹</h3>
<ol>
<li>âœ… <strong>67 % æ›´å°‘çš„æ£€ç´¢å¤±è´¥</strong>ï¼ˆä» 5.7 % é™è‡³ 1.9 %ï¼‰</li>
<li>âœ… <strong>ç®€å•å®ç°</strong>ï¼šåªéœ€åœ¨ç°æœ‰ RAG ç®¡é“ä¸­æ·»åŠ ä¸Šä¸‹æ–‡ç”Ÿæˆæ­¥éª¤</li>
<li>âœ… <strong>æˆæœ¬æ•ˆç›Š</strong>ï¼šæ¯ 1M tokens ä»… $0.29ï¼ŒROI æ˜¾è‘—</li>
<li>âœ… <strong>çµæ´»</strong>ï¼šå¯ä¸ä»»ä½•åµŒå…¥æ¨¡å‹å’Œå‘é‡æ•°æ®åº“é…åˆä½¿ç”¨</li>
<li>âœ… <strong>å¯æ‰©å±•</strong>ï¼šPrompt Caching ä½¿å…¶é€‚ç”¨äºå¤§è§„æ¨¡åº”ç”¨</li>
</ol>
<h3 id="_23">æ¨èé…ç½®</h3>
<p><strong>æ ‡å‡†ç”¨ä¾‹</strong>ï¼š</p>
<ul>
<li>Contextual Embeddingsï¼ˆHaikuï¼‰</li>
<li>Contextual BM25</li>
<li>æ··åˆæ£€ç´¢ï¼ˆ60 % embedding + 40 % BM25ï¼‰</li>
</ul>
<p><strong>é«˜ç²¾åº¦ç”¨ä¾‹</strong>ï¼š</p>
<ul>
<li>ä¸Šè¿°é…ç½® +</li>
<li>Cohere Reranking</li>
</ul>
<h3 id="_24">å¼€å§‹ä½¿ç”¨</h3>
<ol>
<li>è¯„ä¼°å½“å‰ RAG ç³»ç»Ÿçš„æ€§èƒ½</li>
<li>åœ¨å°æ•°æ®é›†ä¸Šå®ç° Contextual Retrieval</li>
<li>æµ‹é‡æ”¹è¿›ï¼ˆå‡†ç¡®ç‡ã€æˆæœ¬ã€å»¶è¿Ÿï¼‰</li>
<li>é€æ­¥æ‰©å±•åˆ°ç”Ÿäº§ç¯å¢ƒ</li>
</ol>
<h2 id="i">é™„å½• Iï¼šåŸºå‡†æµ‹è¯•æ–¹æ³•</h2>
<h3 id="_25">æ•°æ®é›†</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªå¤šæ ·åŒ–çš„æ•°æ®é›†ï¼š</p>
<ol>
<li><strong>Codebase</strong>ï¼ˆ100 ä¸ªä»“åº“ï¼Œ5M tokensï¼‰</li>
<li><strong>ArXiv è®ºæ–‡</strong>ï¼ˆ500 ç¯‡è®ºæ–‡ï¼Œ10M tokensï¼‰</li>
<li><strong>Fiction ä¹¦ç±</strong>ï¼ˆ50 æœ¬ä¹¦ï¼Œ8M tokensï¼‰</li>
</ol>
<h3 id="_26">è¯„ä¼°æŒ‡æ ‡</h3>
<ul>
<li><strong>Top-K å‡†ç¡®ç‡</strong>ï¼šæ­£ç¡®ç­”æ¡ˆåœ¨å‰ K ä¸ªç»“æœä¸­çš„ç™¾åˆ†æ¯”</li>
<li><strong>æ£€ç´¢å¤±è´¥ç‡</strong>ï¼šæœªèƒ½æ£€ç´¢åˆ°ä»»ä½•ç›¸å…³å—çš„æŸ¥è¯¢ç™¾åˆ†æ¯”</li>
<li><strong>MRRï¼ˆMean Reciprocal Rankï¼‰</strong>ï¼šæ­£ç¡®ç­”æ¡ˆæ’åçš„å€’æ•°å¹³å‡å€¼</li>
</ul>
<h3 id="_27">å®éªŒè®¾ç½®</h3>
<ul>
<li>å—å¤§å°ï¼š800 tokens</li>
<li>Top-Kï¼š20ï¼ˆåˆå§‹æ£€ç´¢ï¼‰ï¼Œ5ï¼ˆæœ€ç»ˆç»“æœï¼‰</li>
<li>åµŒå…¥æ¨¡å‹ï¼šOpenAI text-embedding-3-large</li>
<li>Reranking æ¨¡å‹ï¼šCohere rerank-english-v3.0</li>
</ul>
<h2 id="_28">è‡´è°¢</h2>
<p>æ„Ÿè°¢ä¸ºè¿™é¡¹å·¥ä½œåšå‡ºè´¡çŒ®çš„å›¢é˜Ÿæˆå‘˜ï¼š</p>
<ul>
<li>Alexã€Davidã€Eric - ç³»ç»Ÿè®¾è®¡å’Œå®ç°</li>
<li>Mayaã€Sam - è¯„ä¼°å’ŒåŸºå‡†æµ‹è¯•</li>
<li>Product å›¢é˜Ÿ - ç”¨æˆ·ç ”ç©¶å’Œéœ€æ±‚æ”¶é›†</li>
<li>æ‰€æœ‰ Beta æµ‹è¯•äººå‘˜çš„å®è´µåé¦ˆ</li>
</ul>
<h2 id="_29">èµ„æº</h2>
<ul>
<li><a href="https://docs.anthropic.com">Anthropic API æ–‡æ¡£</a></li>
<li><a href="https://docs.anthropic.com/claude/docs/prompt-caching">Prompt Caching æŒ‡å—</a></li>
<li><a href="https://github.com/anthropics/anthropic-cookbook/tree/main/skills/contextual-retrieval">ä»£ç ç¤ºä¾‹</a></li>
<li><a href="https://www.anthropic.com/research/contextual-retrieval">æŠ€æœ¯è®ºæ–‡</a></li>
</ul>
<hr />
<p><strong>æ•´ç†è€…</strong>: Panda
<strong>æ•´ç†æ—¥æœŸ</strong>: 2025 å¹´ 10 æœˆ 29 æ—¥</p>
        
        </article>

        <footer>
            <p style="margin-bottom: 16px;">
                <a href="index.html" style="color: var(--secondary-color); font-weight: 600; text-decoration: none; border-bottom: 2px solid var(--secondary-color);">â† è¿”å›ç´¢å¼•</a>
            </p>
            <p>æœ¬æ–‡æ¡£åŸºäº Anthropic å®˜æ–¹å·¥ç¨‹åšå®¢æ•´ç†ã€‚</p>
            <div class="footer-links">
                <a href="https://www.anthropic.com/engineering" target="_blank">Anthropic Engineering Blog</a>
                <a href="https://docs.anthropic.com" target="_blank">Claude å®˜æ–¹æ–‡æ¡£</a>
                <a href="https://github.com/anthropics/claude-code" target="_blank">Claude Code GitHub</a>
            </div>
            <p style="margin-top: 16px; font-size: 0.85rem;">
                ç”Ÿæˆæ—¶é—´ï¼š2026-02-10 09:11:17<br>
                ç”± <strong>Claude Code Agent Skill</strong> è‡ªåŠ¨ç”Ÿæˆ
            </p>
        </footer>
    </div>

    <!-- å¯¼èˆªå’Œè¿›åº¦æ¡äº¤äº’ -->
    <script>
        // é˜…è¯»è¿›åº¦æ¡
        function updateReadingProgress() {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('reading-progress').style.width = scrolled + '%';

            // æ›´æ–°å›é¡¶æŒ‰é’®çš„åœ†å½¢è¿›åº¦ç¯
            const progressRing = document.querySelector('.progress-ring-progress');
            if (progressRing) {
                const circumference = 2 * Math.PI * 26; // r=26
                const offset = circumference - (scrolled / 100) * circumference;
                progressRing.style.strokeDashoffset = offset;
            }
        }

        // å›é¡¶æŒ‰é’®æ˜¾ç¤º/éšè—
        function updateBackToTopButton() {
            const backToTop = document.getElementById('back-to-top');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        }

        // å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // äº‹ä»¶ç›‘å¬
        window.addEventListener('scroll', function() {
            updateReadingProgress();
            updateBackToTopButton();
        });

        document.getElementById('back-to-top').addEventListener('click', scrollToTop);

        // åˆå§‹åŒ–
        updateReadingProgress();
        updateBackToTopButton();
    </script>

    <!-- Mermaid.js for flowcharts and diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#CC785C',
                primaryTextColor: '#2D2D2D',
                primaryBorderColor: '#E5E5E5',
                lineColor: '#666',
                secondaryColor: '#F5F2ED',
                tertiaryColor: '#FAFAF8'
            }
        });
    </script>
</body>
</html>
