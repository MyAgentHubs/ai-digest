# 构建有效的 AI 智能体

**Building Effective AI Agents**

发布日期：2024 年 12 月 19 日

作者：Erik Schluntz 和 Barry Zhang

---

## 核心要点

Anthropic 在与数十个团队合作开发大语言模型（LLM）智能体的过程中发现，最成功的实现方案采用简单、可组合的模式，而非复杂框架。

---

## 什么是智能体？

文章定义了两个关键概念：

- **工作流（Workflows）**：LLM 和工具通过预定义的代码路径进行编排
- **智能体（Agents）**：LLM 动态指导自身流程和工具使用，维持对任务完成方式的控制

## 何时使用智能体

关键建议："建议寻找尽可能简单的解决方案，仅在必要时增加复杂性"。智能体常以延迟和成本换取更好的任务性能。

## 框架选择指南

文章提到的框架包括：
- LangGraph（来自 LangChain）
- Amazon Bedrock AI Agent 框架
- Rivet（拖拽式 GUI 构建工具）
- Vellum（复杂工作流测试工具）

建议："建议开发者直接使用 LLM API 开始，许多模式可用几行代码实现"。

---

## 核心构建模式

### 增强型 LLM（基础构建块）

提供检索、工具和记忆等增强功能。Anthropic 提出了模型上下文协议（Model Context Protocol, MCP）作为集成第三方工具的方法。

### 工作流模式

#### 1. 提示链接（Prompt Chaining）

将任务分解为顺序步骤，每个 LLM 调用处理前一个的输出，可添加程序检查确保流程正确。

**应用场景**：
- 生成营销文案后翻译
- 先写大纲后完成文档

#### 2. 路由（Routing）

对输入分类并指导到专用任务，支持关注点分离和专用提示优化。

**应用场景**：
- 分类客户服务查询
- 将简单问题路由到 Claude Haiku，复杂问题路由到 Claude Sonnet

#### 3. 并行化（Parallelization）

两个变体：
- **分段（Sectioning）**：将任务分解为独立子任务并行运行
- **投票（Voting）**：多次运行同一任务获得多样输出

**应用场景**：
- 并行内容审核
- 多个提示评估代码漏洞

#### 4. 编排器-工作者（Orchestrator-Workers）

中央 LLM 动态分解任务，委派给工作者 LLM 并综合结果。不同于并行化的预定义性质。

**应用场景**：
- 编辑多个文件的代码产品
- 多源信息搜索任务

#### 5. 评估器-优化器（Evaluator-Optimizer）

一个 LLM 生成响应，另一个在循环中提供评估和反馈。

**应用场景**：
- 文学翻译精化
- 复杂搜索的多轮迭代

### 智能体（Agents）

智能体在以下能力成熟时出现：
- 理解复杂输入
- 推理和规划
- 可靠工具使用
- 错误恢复

**关键特性**：
- 从人类命令或讨论开始
- 独立规划和操作
- 在检查点或遇到阻碍时暂停接收反馈
- 包含停止条件维持控制

**应用场景**：
- 解决 SWE-bench 编程任务
- 计算机使用参考实现

---

## 实践应用案例

### A. 客户支持

智能体适用因素：
- 支持交互自然遵循对话流程，同时需要外部信息和操作访问
- 工具集成客户数据、订单历史和知识库
- 可编程处理退款或更新工单
- 通过用户定义的解决方案清晰测量成功

多家公司采用按使用付费模式（仅对成功解决收费），表明对智能体有效性的信心。

### B. 编码智能体

优势：
- 代码解决方案通过自动化测试验证
- 智能体可使用测试结果作为反馈迭代
- 问题空间明确结构化
- 输出质量客观可测

Anthropic 的实现可"基于拉取请求描述单独解决真实 GitHub 问题"（SWE-bench Verified 基准），但人工审查仍对确保解决方案与更广系统要求一致至关重要。

---

## 工具提示工程（附录）

### 工具设计原则

有多种方式指定相同操作（如 diff vs 完整文件重写）。关键建议：

1. **给模型足够 token 在写入前"思考"**
2. **保持格式接近互联网文本中自然出现的内容**
3. **确保无格式开销**，如精确计数数千行代码

### Agent-Computer Interface (ACI) 最佳实践

- **从模型视角考虑**：清晰的工具使用说明
- **使用清晰的参数名称和文档**
- **在 workbench 中测试**多个输入示例
- **应用防错原则**（Poka-yoke）简化参数使用

**案例**：Anthropic 在 SWE-bench 中花费更多时间优化工具而非整体提示。将相对文件路径改为绝对路径后，模型使用变得无懈可击。

---

## 三个核心原则

实现智能体时遵循：

1. **简洁性（Simplicity）**：在智能体设计中保持简洁
2. **透明性（Transparency）**：明确展示智能体的规划步骤
3. **文档和测试（Documentation）**：精心设计 Agent-Computer 接口

"框架可快速启动，但在迁移到生产环境时，不要犹豫减少抽象层，用基础组件构建"。

---

## 核心建议总结

- 成功不在于最精密的系统，而在于"为需求构建正确的系统"
- 从简单提示开始，通过全面评估优化，仅在更简单解决方案不足时添加多步智能体系统
- 模式不是规范性的，可组合调整以适应不同用例
- 性能测量和实现迭代是关键
- "仅当明确改进结果时考虑增加复杂性"

---

## 工作流程示意图

原文包含以下架构图表：

1. **工作流模式总览**：展示提示链接、路由、并行化等模式的结构
2. **智能体架构**：展示智能体如何与工具和环境交互
3. **编码智能体流程**：展示从问题描述到解决方案的完整流程

---

*注：本文由 Anthropic 工程团队基于实际项目经验总结而成，为开发者提供了从基础工作流到复杂智能体系统的完整构建指南。*
